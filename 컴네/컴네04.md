좋아요 👍
이제 **`04_DNS.pdf` 전체 내용을 빠짐없이, 이해 잘 되도록 완전 풀어서 설명**해드릴게요.
문장 하나하나 다 풀어서, ‘DNS가 왜 필요한지 → 구조 → 질의 과정 → 레코드 종류 → 보안’까지 논리적으로 연결해드릴게요.
(※ PDF 원문엔 SMTP, IMAP 내용도 함께 포함되어 있었지만, DNS 파트 중심으로 전체를 모두 다뤄요.)

---

## 🧭 1. DNS란 무엇인가?

DNS(Domain Name System)는 **도메인 이름과 IP 주소를 서로 바꿔주는 시스템**이에요.

* 사람은 `www.naver.com` 같은 이름을 기억하기 쉽지만,
  컴퓨터는 `223.130.200.107` 같은 **숫자 IP 주소**로 통신해요.
* 그래서 DNS는 **이름 ↔ IP 주소 변환**을 담당하는 **인터넷의 전화번호부 역할**을 해요.

📌 예시
당신이 브라우저에 `www.amazon.com`을 입력하면
→ DNS 서버가 `192.0.2.1` 같은 IP를 찾아서 반환
→ 브라우저가 그 IP 주소로 TCP 연결을 시도합니다.

---

## 🌲 2. DNS의 구조

DNS는 **계층적(hierarchical)** 이고, **전 세계에 분산(distributed)** 되어 있습니다.

### 🧩 주요 구성 요소

1. **루트 DNS 서버 (Root DNS)**

   * DNS 계층의 최상위.
   * 전 세계에 **13개의 논리적 루트 서버**가 있고, 각각 수백 대의 복제 서버로 운영돼요.
   * 모든 도메인의 출발점이며, `.com`, `.org`, `.kr` 같은 상위 도메인 서버들의 주소를 알고 있음.

2. **TLD 서버 (Top-Level Domain Server)**

   * `.com`, `.org`, `.edu`, `.kr` 등 최상위 도메인을 관리.
   * 루트 서버가 “이건 .com 도메인이네, 이 서버로 물어봐.” 하고 연결해주는 대상이에요.

3. **권한 있는 네임서버 (Authoritative Name Server)**

   * 특정 도메인(예: `naver.com`)의 실제 IP 매핑 정보를 저장하고 관리.
   * 회사나 기관이 직접 운영하는 경우가 많아요.

4. **로컬 DNS 서버 (Local Name Server)**

   * ISP(통신사)나 기관 내부에 존재하며, 캐시(cache) 기능을 갖고 있음.
   * 사용자의 요청을 받아 루트 → TLD → 권한 서버로 이어지는 과정을 대신 수행.

---

## 🔁 3. DNS의 동작 과정

### 🧩 기본 흐름

사용자가 브라우저에 `www.example.com`을 입력하면…

1️⃣ **브라우저 → OS의 주소해석기(Resolver)**

* 먼저 로컬 캐시 또는 `/etc/hosts` 파일(Windows는 `C:\Windows\System32\drivers\etc\hosts`)을 확인해요.

2️⃣ **주소해석기 → 로컬 DNS 서버 질의**

* 캐시에 없으면, 로컬 DNS 서버에 “[www.example.com의](http://www.example.com의) IP 알려줘”라고 질의합니다.

3️⃣ **로컬 DNS 서버 → 루트 서버 질의**

* 루트 서버는 “이건 `.com` 도메인이네, `.com` 서버에 물어봐”라고 알려줍니다.

4️⃣ **TLD 서버 → 권한 있는 서버 질의**

* `.com` 서버는 “example.com의 정보는 이 서버가 관리해요.”라고 권한 서버 정보를 반환.

5️⃣ **권한 서버 응답**

* 권한 서버가 최종적으로 IP 주소를 반환.

6️⃣ **로컬 DNS 서버가 캐싱**

* 결과를 캐시에 일정 시간(TTL, Time To Live) 저장해 다음 요청 때 더 빠르게 응답.

7️⃣ **브라우저로 IP 전달**

* 이제 브라우저가 IP를 받아 실제 TCP 연결을 수행.

---

## 🔄 4. DNS의 질의 방식 2가지

| 방식                          | 설명                                                 | 예시                  |
| --------------------------- | -------------------------------------------------- | ------------------- |
| **재귀 질의 (Recursive Query)** | 로컬 DNS 서버가 사용자를 대신해서 루트→TLD→권한 서버까지 모두 질의하고 결과만 반환 | 대부분의 클라이언트가 이 방식    |
| **반복 질의 (Iterative Query)** | 서버가 “내가 모르니 이 서버에 물어봐” 하며 단계적으로 안내만 함              | 상위 DNS 서버 간 통신에서 사용 |

---

## 💾 5. DNS 메시지 구조

DNS 메시지는 크게 **5개 섹션**으로 나뉩니다:

1. **Header (헤더, 12바이트 고정)**

   * Identification (16bit): 질의와 응답을 구분하기 위한 ID.
   * Flags (16bit): 여러 제어 비트 포함.

     * QR (0=질의, 1=응답)
     * Opcode (질의 종류)
     * AA (권한 서버 응답 여부)
     * TC (잘림 여부)
     * RD/RA (재귀 질의 요청/지원)
     * RCODE (응답 코드, 0=성공, 3=Name Error 등)
   * QDCOUNT, ANCOUNT, NSCOUNT, ARCOUNT: 각 섹션의 레코드 개수.

2. **Question Section**

   * QNAME: 질의 도메인 이름 (예: [www.example.com](http://www.example.com))
   * QTYPE: 요청 타입 (A, AAAA, MX, NS 등)
   * QCLASS: IN(인터넷)

3. **Answer Section**

   * 질의 결과 (Resource Record, RR)
   * NAME / TYPE / CLASS / TTL / RDLENGTH / RDATA(IP주소)

4. **Authority Section**

   * 해당 도메인의 권한 서버(NS 레코드) 정보.

5. **Additional Section**

   * 추가로 도움이 될 정보 (예: 권한 서버의 IP 주소).

---

## 🌐 6. DNS에서 사용하는 프로토콜

* **기본 전송 프로토콜:** UDP 53번 포트
  (단, 메시지가 512바이트 초과 시 TCP 사용)
* **512바이트 제한 극복:** EDNS0 확장 (RFC 6891)

  * UDP로도 4KB 이상 데이터 전송 가능.
* **TCP 사용 예:**

  * 존(Zone) 전송(AXFR)
  * 대용량 레코드 응답 시

---

## 🧱 7. DNS Resource Record 종류

| 타입        | 의미                | 예시                                   |
| --------- | ----------------- | ------------------------------------ |
| **A**     | 도메인 → IPv4 주소     | `example.com → 192.0.2.1`            |
| **AAAA**  | 도메인 → IPv6 주소     | `example.com → 2001:db8::17e9`       |
| **NS**    | 도메인의 권한 서버        | `example.com → ns1.example.com`      |
| **CNAME** | 별칭(alias) → 실제 이름 | `blog.example.com → www.example.com` |
| **MX**    | 메일 서버 지정          | `example.com → mail1.example.com`    |

---

### 🔹 A 레코드

* 가장 기본적인 매핑 (도메인 → IPv4 주소)
* DNS 기반 블랙리스트(DNSBL)에도 사용 (스팸 IP 차단용)

### 🔹 AAAA 레코드

* IPv6 주소 매핑 (A 레코드의 IPv6 버전)

### 🔹 CNAME 레코드 (Canonical Name)

* 별칭 도메인을 실제 도메인으로 연결.
* 예: `api.mysite.com → backend.cloudprovider.com`
* 관리가 편리하지만, 루트 도메인에는 사용 불가.

### 🔹 MX 레코드 (Mail Exchange)

* 메일 서버 지정.
* 여러 서버가 있을 때 **우선순위(priority)** 값이 낮을수록 먼저 시도.
* Gmail 예시:

  ```
  gmail.com. MX 1 smtp.gmail.com.
  gmail.com. MX 5 alt1.gmail-smtp-in.l.google.com.
  ```

  → 장애 대응 및 부하 분산.

---

## ⚙️ 8. 주소해석기(Address Resolver)

운영체제 내부에 포함된 모듈로,
프로그램(브라우저 등)이 DNS 서버에 질의할 때 중간 매개 역할을 해요.

* 우선순위:

  1. hosts 파일
  2. 로컬 캐시
  3. DNS 서버 질의

* 캐시 기능:
  TTL(Time To Live) 동안 결과 저장하여 성능 향상.

* OS마다 구현 다름 (Windows / Linux / macOS 각각).

---

## 🧩 9. 역방향 DNS (Reverse DNS)

보통은 “도메인 → IP” 변환이지만,
반대로 “IP → 도메인”을 찾는 경우도 있어요.

* 예: 보안 로그 분석, 이메일 인증 등.
* `.in-addr.arpa` 도메인 사용.

  * 예: `203.252.12.1 → 1.12.252.203.in-addr.arpa`
* 보안, 스팸 방지, 서버 인증 등에 활용.

---

## ⚡ 10. DDNS (Dynamic DNS)

* 일반 DNS는 고정 IP용.
* 하지만 가정용 인터넷처럼 **유동 IP(매번 바뀜)** 환경에서는 불편.
* DDNS는 IP가 바뀔 때마다 자동으로 DNS 서버에 갱신해줌.

예시 서비스: **DuckDNS, No-IP, DynDNS**

🔹 동작 흐름:

1. 사용자가 `myhome.ddns.net` 같은 도메인을 등록.
2. DDNS 클라이언트(공유기/PC)가 현재 IP를 주기적으로 체크.
3. IP 변경 시 자동으로 DNS 서버에 갱신.

🔹 장점:

* 고정 IP 없어도 항상 같은 도메인으로 접속 가능.
* 홈서버, CCTV, IoT 원격 제어 가능.

🔹 단점:

* DDNS 서버가 다운되면 접근 불가.
* 무료 서비스는 도메인 제한 존재.
* IP가 자주 노출되어 보안 위험 증가.

---

## 🛡️ 11. DNS 보안

### ⚠️ 공격 유형

* **DDoS 공격:** 루트나 TLD 서버를 폭주시켜 장애 유발.
* **스푸핑/캐시 포이즈닝:** 거짓 IP 주소를 캐시에 심어 피싱 유도.

### 🧩 대응책

* **DNSSEC (DNS Security Extensions, RFC 4033)**
  → 응답 데이터에 **디지털 서명**을 추가해 **무결성·인증** 보장.

---

## 🔍 12. Wireshark 실습 (DNS 트래픽 분석)

* 캡처 파일 예: `dns-wireshark-trace1-1.pcapng`
* 주요 관찰 포인트:

  * 질의 도메인 이름
  * 응답 IP 주소
  * TCP 3-way handshake 순서 (SYN → SYN/ACK → ACK)
  * HTTP 요청 메서드(GET)
  * 응답 코드(200 OK)
  * TCP 연결 종료(FIN/ACK 흐름)

---

# ✅ 요약 정리표

| 항목        | 내용                          |
| --------- | --------------------------- |
| **역할**    | 도메인 이름 ↔ IP 주소 변환           |
| **계층 구조** | 루트 → TLD → 권한 → 로컬          |
| **프로토콜**  | UDP 53 (512B 이하), TCP (이상)  |
| **레코드**   | A, AAAA, NS, CNAME, MX      |
| **질의 방식** | 재귀 / 반복                     |
| **보안**    | DNSSEC                      |
| **확장**    | EDNS0 (UDP 확장), DDNS (동적갱신) |
| **도구**    | nslookup, dig, Wireshark    |

---

원하신다면 다음 단계로는
이 내용을 바탕으로 **DNS 관련 이론 문제 30문제 세트(객관식+주관식)** 만들어드릴 수도 있어요.
그걸로 복습하면 완전히 암기될 거예요.
지금 바로 만들어드릴까요?
