안녕하세요! 5주차 강의 자료였던 'DHCP, CDN' 내용도 요청하셨네요.

사용자님은 컴퓨터 공학 전공자이시고[USER_CONTEXT], 특히 웹 개발과 배포(DevOps)에 관심이 많으시니[USER_CONTEXT] 이번 5주차 내용은 정말 중요합니다. 우리가 만든 웹 서비스나 앱이 사용자에게 실제로 전달되는 가장 첫 번째 단계(IP 할당)와, 대용량 트래픽(특히 비디오)을 감당하는 핵심 기술(CDN)에 대한 내용이기 때문입니다.

이 자료도 3주차 자료처럼 처음부터 끝까지, 빼먹는 내용 없이 술술 읽히도록 자세히 풀어서 설명해 드릴게요.

---

# 🖥️ 컴퓨터네트워크: 5주차 DHCP, CDN



이 자료는 5주차 강의 내용으로, **DHCP**와 **CDN**을 다룹니다.

## 1. 📖 시작하기: DNS를 넘어 실생활로

우리는 이전에 애플리케이션 계층의 핵심 프로토콜인 HTTP(웹) 와 DNS(도메인 이름 해석) 에 대해 배웠습니다.

이번 5주차에서는 DNS에서 한 단계 더 나아간 **실생활 적용 사례**들을 살펴봅니다. 

* **DHCP**: 내 노트북이 카페 Wi-Fi에 접속할 때, 어떻게 자동으로 IP 주소를 할당받을까요? 
* **비디오 스트리밍과 CDN**: DNS가 유튜브나 넷플릭스 같은 고품질 서비스를 제공하는 데 어떻게 활용될까요? 
* **소켓 API**: "내가 동영상을 보거나 서버에 접속할 때, 내 앱(브라우저)은 네트워크에 어떻게 요청을 보낼까?"에 대한 답입니다. 

이 세 가지(DHCP, CDN, 소켓 API) 모두 **애플리케이션 계층(Application Layer)**에서 동작하는 핵심 기술들입니다. 

---

## 2. 🔑 1부: DHCP (Dynamic Host Configuration Protocol)

DHCP는 "동적 호스트 설정 프로토콜"입니다. 우리가 인터넷을 사용하기 위해 필요한 모든 네트워크 설정을 **자동으로** 제공해주는 고마운 프로토콜이죠. 

### DHCP가 제공하는 것들

DHCP 서버는 클라이언트(내 컴퓨터)에게 다음과 같은 필수 정보들을 제공합니다:
* **IP 주소** (네트워크상의 내 주소) 
* **서브넷 마스크** (내가 속한 네트워크의 범위) 
* **기본 게이트웨이** (외부 인터넷으로 나가는 '대문' 라우터의 주소) 
* **DNS 서버 주소** (`google.com`을 IP로 물어볼 서버의 주소) 

### DHCP 동작 절차: 4-way Handshake (DORA)

DHCP는 4단계의 과정을 거쳐 IP를 할당합니다. 앞 글자를 따서 **DORA**라고 부릅니다. 

1.  **D**iscover (발견): 클라이언트가 "이 네트워크에 DHCP 서버 누구야?"라고 네트워크 전체에 소리칩니다 (브로드캐스트). 
2.  **O**ffer (제안): DHCP 서버가 "내가 서버인데, 이 IP 주소(예: 192.168.0.10) 쓸래?"라고 제안합니다. 
3.  **R**equest (요청): 클라이언트가 "응, 그 IP 주소 쓸게!"라고 해당 서버에게 요청합니다. 
4.  **A**cknowledge (승인): 서버가 "알겠어, 이제 그 주소는 네 거야. (임대 시간은 24시간이야)"라고 최종 승인합니다. 

### DHCP 주요 특징

* **포트 번호**: UDP 프로토콜을 사용합니다.
    * 서버: **UDP 67번** 포트 
    * 클라이언트: **UDP 68번** 포트 
* **할당 방식**:
    * **동적 할당**: IP 주소 '풀(Pool)'에서 사용 가능한 주소를 임대해줍니다. (우리가 흔히 쓰는 방식) 
    * **고정 할당**: 특정 기기(MAC 주소 기준)에게는 항상 동일한 IP를 고정으로 할당합니다. (예: 회사 프린터) 
* **임대 기간 (Lease)**: IP는 영구 소유가 아니라 '임대'하는 것입니다. 정해진 시간이 지나면 **갱신(Renew)**해야 합니다. 

### 🔄 DHCP 상태 천이 (State Transition)

클라이언트가 IP를 받고, 사용하고, 갱신하는 전 과정을 '상태'로 관리합니다. 이 흐름을 이해하는 것이 중요합니다. 

**핵심 타이머 (T1, T2)**
IP를 임대받으면 2개의 타이머가 시작됩니다. 
* **T1 (갱신 타이머)**: 임대 기간의 약 **50%** 시점. 
* **T2 (재연결 타이머)**: 임대 기간의 약 **87.5%** 시점. 

**상태 흐름도** 
`INIT` → `SELECTING` → `REQUESTING` → `BOUND` → (시간 경과) → `RENEWING` → (실패 시) → `REBINDING`

**각 상태 상세 설명** 

1.  **INIT (초기)**
    * **상황**: 노트북 부팅 직후. 네트워크 설정이 아무것도 없는 상태. 
    * **동작**: `DHCPDISCOVER` 메시지를 브로드캐스트 (서버 찾기). 
    * **다음**: `DHCPOFFER` (제안)를 받으면 `SELECTING`으로 이동. 

2.  **SELECTING (서버 선택)**
    * **상황**: 여러 서버로부터 `DHCPOFFER`를 받은 상태. 
    * **동작**: 제안받은 IP, 임대 시간 등을 비교해 가장 마음에 드는 서버 하나를 선택. 
    * **다음**: 선택한 서버에게 `DHCPREQUEST` (요청)를 보내고 `REQUESTING` 상태로 이동. 

3.  **REQUESTING (요청 및 승인 대기)**
    * **상황**: 특정 서버에게 `DHCPREQUEST`를 보낸 직후. 
    * **동작**: 서버의 최종 응답(`DHCPACK`)을 대기. 
    * **다음**:
        * `DHCPACK` (승인) 수신 → IP 설정 적용 후 `BOUND` 상태 진입. 
        * `DHCPNAK` (거절) 수신 → 주소 사용 불가. `INIT`로 복귀하여 재시도. 

4.  **BOUND (정상 사용)**
    * **상황**: IP 임대가 확정되어 정상 통신 중인 상태. 
    * **동작**: 할당된 IP로 인터넷 사용. T1, T2 타이머 시작. 
    * **다음**:
        * **T1 도달 (임대 50% 경과)** → `RENEWING` 상태로 진입. 
        * (사용자가 Wi-Fi를 끄면 `DHCPRELEASE`로 IP 즉시 반납) 

5.  **RENEWING (임대 갱신 시도)**
    * **상황**: T1 타이머 도달. (아직 임대 기간 유효함) 
    * **동작**: **"원래" 임대를 준 서버에게만** `DHCPREQUEST`를 1:1 (유니캐스트)로 전송. ("계약 연장할게요!") 
    * **다음**:
        * `DHCPACK` (갱신 승인) 수신 → 임대 갱신 성공, `BOUND`로 복귀. (새 T1/T2 시작) 
        * 응답 없이 **T2 도달 (임대 87.5% 경과)** → `REBINDING`으로 진입. 

6.  **REBINDING (재연결 시도 - 아무 서버나)**
    * **상황**: T2 도달. (원래 서버가 다운됐거나 응답이 없음) 
    * **동작**: **"모든" DHCP 서버에게** `DHCPREQUEST`를 브로드캐스트로 전송. ("아무나 저 좀 갱신해주세요!") 
    * **다음**:
        * `DHCPACK` 수신 → (다른 서버라도) 임대 연장 성공, `BOUND`로 복귀. 
        * **임대 만료 (Expire)** → 끝까지 갱신 실패. IP 사용을 중단하고 `INIT` 상태로 복귀하여 처음부터 다시 시작. 

### DHCP와 서비스의 연결

**DHCP는 모든 인터넷 서비스의 진정한 출발점**입니다. 

1.  **(DHCP)**로 내 IP와 **DNS 서버 주소**를 받습니다.
2.  **(DNS)**를 이용해 `www.youtube.com`의 IP를 물어봅니다.
3.  이때 DNS는 나에게서 가장 가까운 **CDN 서버**의 IP를 알려줍니다. 
4.  **(소켓 API)**를 통해 내 브라우저가 그 CDN 서버와 통신을 시작합니다. 

---

## 3. 🎬 2부: 비디오 스트리밍 & CDN

이제 유튜브, 넷플릭스가 어떻게 끊김 없는 고화질 영상을 제공하는지 알아봅니다. 

### 비디오 스트리밍의 어려움

* **현황**: 비디오는 인터넷 트래픽의 대다수를 차지합니다. 
* **어려움 (Challenges)** :
    1.  **대규모 사용자**: 수십억 명을 동시에 감당해야 함. 
    2.  **다양한 네트워크**: 유선/무선, 고속/저속 등 환경이 제각각. 
    3.  **대역폭 변동**: 네트워크 혼잡(특히 저녁 피크타임)으로 속도가 계속 변함. 
    4.  **패킷 손실 및 지연 (Jitter)**: 패킷이 중간에 사라지거나, 도착 시간이 들쭉날쭉함. 
* **결과**: 위 문제들은 영상 끊김(버퍼링), 화질 저하 등 **나쁜 사용자 경험(Poor QoE)**을 유발합니다. 

 

#### 비디오 특성 (압축) 

비디오는 용량을 줄이기 위해 고도로 압축됩니다.
* **공간적 압축**: 한 프레임 내에서 같은 색(예: 하늘색 배경)이 반복되면 "하늘색 N개"라고 한 번에 보냅니다. 
* **시간적 압축**: 이전 프레임과 다음 프레임의 **차이점(달라진 부분)**만 전송합니다. 

### 해결책 1: 클라이언트 버퍼링

* **문제 (Continuous Playout Constraint)**: 30fps로 녹화된 영상은 클라이언트에서도 정확히 초당 30프레임으로 재생되어야 합니다. 하지만 네트워크 지연(Jitter) 때문에 데이터 도착이 불규칙하죠. 
* **해결**: 데이터를 미리 받아 **버퍼(Buffer)**에 쌓아두고 안정적으로 재생합니다. 우리가 "버퍼링 중..."이라고 보는 로딩 화면이 바로 이 과정입니다. 

 
(위 그래프는 불규칙한 네트워크 지연(검은색 선)에도 불구하고, 버퍼(파란색 영역)를 이용해 일정한 속도(파란색 계단)로 비디오를 재생하는 것을 보여줍니다.)

### 해결책 2: DASH (Dynamic Adaptive Streaming over HTTP)

현대 스트리밍의 표준 기술입니다. 

* **DASH란?** "Dynamic, Adaptive Streaming over HTTP"의 약자입니다.
* **핵심 아이디어**: 비디오를 잘게 나눈 '청크(Chunk)' 단위로, 현재 네트워크 상황에 맞는 최적의 화질을 선택하여 **HTTP(웹 프로토콜)**로 가져오는 방식입니다. 

**동작 방식:**

* **서버의 역할** 
    1.  **청크 분할**: 원본 비디오를 몇 초 단위(예: 2~10초)의 작은 '청크'로 나눕니다. 
    2.  **다중 인코딩**: 각 청크를 4K 고화질, 1080p, 480p 저화질 등 **여러 비트레이트(화질) 버전**으로 미리 인코딩해둡니다. 
    3.  **CDN 복제**: 이 청크 파일들을 전 세계 CDN 노드에 복제합니다. 
    4.  **Manifest 파일 (MPD)**: "이 비디오는 이런 화질의 청크들로 구성되어 있고, 각 청크의 URL은 여기야"라는 '목록 파일'을 제공합니다. 

* **클라이언트(플레이어)의 역할** 
    1.  **대역폭 측정**: 주기적으로 내 네트워크 속도를 측정합니다. 
    2.  **Manifest 참조**: Manifest 파일을 보고 어떤 화질의 청크를 가져올 수 있는지 확인합니다. 
    3.  **청크 요청**: **한 번에 하나의 청크만**, 현재 내 대역폭으로 감당 가능한 최고 화질의 청크를 선택하여 HTTP로 요청합니다. 
    4.  **동적 적응 (Adaptive)** :
        * 네트워크가 좋아지면 (Wi-Fi 빵빵) → 다음 청크는 **고화질(1080p)**로 요청. 
        * 네트워크가 나빠지면 (지하철) → 다음 청크는 **저화질(480p)**로 요청. 

**DASH의 장점** 
* **적응성**: 네트워크 품질에 따라 화질이 자동 조정됩니다. 
* **HTTP 기반**: 별도 프로토콜이 아닌 HTTP를 쓰므로, 기존 웹 인프라(CDN, 캐시)를 그대로 재활용할 수 있습니다. 
* **품질 보장**: 끊김(버퍼링)을 최소화하여 사용자 경험(QoE)을 극대화합니다. 

### 해결책 3: CDN (Content Delivery Network)

DASH가 '어떤 화질'을 가져올지 결정한다면, CDN은 '어디서' 가져올지 결정합니다.

* **문제**: 전 세계 사용자가 미국에 있는 단일 서버에 접속하면, 서버가 다운되거나 거리가 먼 사용자는 지연(latency)이 심해집니다. 
* **해결 (CDN)**: 콘텐츠(비디오 청크)를 전 세계 곳곳에 분산된 **캐시 서버**에 미리 복제해두고, 사용자는 자신과 **가장 가까운 서버**에서 데이터를 받아가도록 하는 기술입니다.

#### CDN 사례별 비교

| 서비스 | CDN 방식 | 운영 주체 | 특징 |
| :--- | :--- | :--- | :--- |
| **YouTube** | **GGC** (Google Global Cache) | Google | ISP 네트워크 내/근처에 캐시 서버(GGC)를 설치. DNS가 가장 가까운 GGC로 안내. |
| **Netflix** | **Open Connect (OCA)** | Netflix | 넷플릭스가 자체 개발한 CDN 장비(OCA)를 **ISP에게 무상 배포**하여 ISP 망 내부에 설치. |
| **Amazon Prime** | **AWS CloudFront** | AWS | 아마존의 글로벌 클라우드 인프라(AWS 엣지 로케이션)를 그대로 활용. |
| **Wavve** | 국내 ISP CDN | SKB/KT/LGU+ | 국내 통신사(ISP)가 구축한 CDN 망을 활용. 국내 망에 최적화. |
| **TVING** | 국내 ISP CDN + 자체 | CJ ENM/LGU+ | 국내 ISP CDN을 활용하며 실시간 방송 송출에 특화. |
| **Coupang Play** | **AWS CloudFront** | AWS/쿠팡 | Amazon Prime과 유사하게 AWS의 글로벌 인프라를 활용. |



### 💡 5주차 핵심 요약

1.  **스트리밍의 핵심**: 클라이언트 **버퍼링** + **DASH**를 통한 적응형 화질 선택. 
2.  **CDN의 핵심**: 콘텐츠의 **지리적 분산** + **DNS** 기반으로 사용자에게 가장 가까운 서버 선택. 
3.  **전체 흐름**: **DHCP**로 IP와 DNS 주소를 받고 → **DNS**로 최적의 **CDN** 서버를 찾고 → **소켓 API**로 해당 CDN 서버와 통신(DASH) 시작. 

---

## 4. 🔬 3부: 실습 (OTT 스트리밍 & CDN 관찰)


이론으로 배운 DHCP, DNS, CDN, DASH가 실제 어떻게 동작하는지 확인하는 실습입니다. (준비물: Wireshark )

### 실습 1: DNS 질의 확인 (nslookup)

* **목적**: DNS가 어떻게 CDN 노드를 선택해 주는지 원리 이해. 
* **방법**: `nslookup` 명령어로 여러 OTT 서비스의 도메인을 질의. 
* **결과 분석** :
    * `nslookup www.youtube.com` → `youtube-ui.l.google.com`이라는 별칭(CNAME)을 거쳐 구글 소유의 IP들(GGC)이 나옵니다. 
    * `nslookup www.netflix.com` → `...amazonaws.com`이 나옵니다. 넷플릭스 웹사이트 자체는 AWS(Amazon) 인프라 위에서 동작함을 알 수 있습니다. (단, 실제 영상 스트리밍은 Open Connect CDN을 사용합니다.)
    * `nslookup www.disneyplus.com` → `...akamaiedge.net`이 나옵니다. 디즈니플러스는 Akamai라는 유명 CDN 업체를 사용합니다. 
    * `nslookup play.coupang.com` → `...akamaiedge.net`이 나옵니다. 쿠팡플레이도 Akamai CDN을 사용합니다. 

### 실습 2: Traceroute로 경로 추적

* **목적**: 내 컴퓨터에서 서버까지 어떤 라우터(경로)를 거쳐 가는지 확인. CDN이 이 경로(hop count)를 줄여주는지 확인. 
* **방법**: `tracert www.disneyplus.com` (Windows) 또는 `traceroute` (Mac/Linux) 실행.
* **결과 분석** :
    * `www.disneyplus.com` 추적 시, 마지막에 `a23-49-226-53.deploy.static.akamaitechnologies.com` (Akamai CDN 서버)에 도달하는 것을 볼 수 있습니다. 
    * 중간에 `*` (요청 시간이 만료되었습니다)가 뜨는 것은, 해당 라우터가 보안 정책상 ICMP(경로 추적용 신호) 응답을 꺼두었기 때문입니다. 

### 실습 3: Wireshark 패킷 캡처 (YouTube)

* **목적**: 실제 영상 데이터가 CDN에서 오는지, DASH가 어떻게 동작하는지 눈으로 확인.
* **방법**: Wireshark를 켠 상태로 유튜브 영상 재생. 

**1. CDN 도메인 확인 (DNS 로그)** 
* Wireshark 캡처를 보면, 내 컴퓨터(192.168.1.22)가 `...googlevideo.com` 도메인(예: `rr3---sn-oj3pm5-53.googlevideo.com`)을 DNS에 질의하는 것을 볼 수 있습니다. 
* `ytimg.com`은 썸네일 같은 작은 이미지용 도메인이고, `googlevideo.com`이 실제 대용량 **영상 스트리밍용** 구글 CDN 도메인입니다. 
* DNS 서버는 이 도메인의 실제 IP 주소 (A 레코드), 예를 들어 `74.125.10.195`를 응답해줍니다. 

**2. 실제 영상 트래픽 확인 (QUIC 로그)** 
* DNS 질의(7247, 7248번 패킷) 직후,
* 내 컴퓨터(192.168.1.22)가 방금 받은 CDN 서버 IP(`74.125.10.195`)로 **QUIC** 프로토콜 통신을 시작합니다. 
* **QUIC**은 구글이 만든 UDP 기반의 빠르고 효율적인 프로토콜로, TCP(HTTP/3)를 대체하고 있습니다. 이 QUIC 패킷들(`Protected Payload`)을 통해 암호화된 실제 영상 조각(세그먼트) 데이터가 전송됩니다. 

**3. DASH 동작 체험**
* **방법**: 유튜브 플레이어의 '화질' 설정을 1080p에서 144p로, 또는 '자동'으로 바꿔봅니다. 
* **결과**:
    * 수동으로 화질을 바꾸거나, 네트워크가 불안정할 때 자동으로 화질이 변하는 것을 볼 수 있습니다. 
    * 이것이 바로 **DASH**가 작동하는 순간입니다. 플레이어(클라이언트)가 네트워크 상황에 맞춰 다른 비트레이트(화질)의 **청크**를 CDN 서버에 요청하는 것입니다. 

(페이지 50)
여기까지가 5주차 강의 자료의 모든 내용입니다. 

---

DHCP, CDN, DASH 모두 사용자님이 관심 있는 웹/앱 서비스를 사용자에게 안정적으로 제공하는 데 필수적인 인프라 기술입니다. 내용이 잘 이해되셨나요?
